# Деплой бота на Railway

Этот документ описывает процесс деплоя бота оптимизации Windows на платформу Railway.

## Подготовка к деплою

1. Создайте аккаунт на [Railway](https://railway.app/) если у вас его еще нет
2. Убедитесь, что у вас настроены следующие файлы:
   - `railway.json` - конфигурация Railway
   - `Procfile` - команда для запуска бота
   - `runtime.txt` - версия Python
   - `requirements.txt` - зависимости
   - `.gitignore` - исключения для гит
   - `.dockerignore` - исключения для Docker-образа

## Способы деплоя

Есть два основных способа деплоя на Railway:

### Способ 1: Деплой через GitHub (с репозиторием)

1. **Создайте новый проект в Railway**:
   - Войдите в свой аккаунт Railway
   - Нажмите "New Project"
   - Выберите "Deploy from GitHub repo"

2. **Подключите репозиторий GitHub**:
   - Выберите ваш репозиторий с ботом
   - Railway автоматически обнаружит файл `railway.json`

3. **Настройте переменные окружения**:
   - В проекте перейдите в раздел "Variables"
   - Добавьте следующие переменные:
     - `TELEGRAM_TOKEN` - токен вашего Telegram бота
     - `ANTHROPIC_API_KEY` - API ключ Anthropic Claude
     - `CLAUDE_MODEL` - модель Claude (например, claude-3-5-sonnet-20240620)
     - `LOG_LEVEL` - уровень логирования (INFO, DEBUG и т.д.)
     - `ALLOWED_USERS` - ID пользователей Telegram (опционально)
     - `ADMIN_USER_ID` - ID администратора (опционально)
     - `RAILWAY_ENVIRONMENT` - установите в `production`

### Способ 2: Деплой через CLI (без репозитория)

Если вы хотите отвязать проект от Git или не использовать GitHub:

1. **Очистите Git-репозиторий**:
   - В Windows: запустите `clean_git.bat`
   - В Linux/Mac: запустите `clean_git.sh`

2. **Установите Railway CLI**:
   - Установите Node.js, если еще не установлен
   - Выполните: `npm i -g @railway/cli`
   - Войдите в аккаунт: `railway login`

3. **Создайте новый проект**:
   - Войдите на https://railway.app
   - Создайте новый пустой проект
   - Скопируйте ID проекта

4. **Свяжите локальную директорию с проектом**:
   - Выполните: `railway link`
   - Выберите созданный проект

5. **Настройте переменные окружения**:
   - Создайте `.env.production` из файла `.env.example` 
   - Заполните все необходимые переменные окружения
   - Или настройте переменные через веб-интерфейс Railway

6. **Выполните деплой**:
   - Выполните: `railway up`
   - Дождитесь окончания деплоя

## Проверка работоспособности

После успешного деплоя:

1. Найдите URL вашего сервиса в разделе "Deployments"
2. Отправьте сообщение `/start` вашему боту в Telegram
3. Убедитесь, что бот отвечает и работает корректно

## Мониторинг и логи

Railway предоставляет инструменты для мониторинга:

1. **Логи**: Перейдите в раздел "Deployments" -> выберите деплой -> "Logs"
2. **Метрики**: Просматривайте использование CPU, памяти и других ресурсов

## Обновление бота

### При деплое через GitHub:
1. Внесите изменения в код
2. Сделайте коммит и push в репозиторий
3. Railway автоматически обнаружит изменения и выполнит новый деплой

### При деплое через CLI:
1. Внесите изменения в код
2. Выполните: `railway up`
3. Railway выполнит новый деплой с обновлениями

## Устранение проблем

### Бот не запускается

Проверьте логи в Railway для определения причины:
- Ошибки в коде
- Проблемы с переменными окружения
- Недостаточно ресурсов

### Ошибки при отправке сообщений

Убедитесь, что:
- Токен Telegram указан правильно
- Бот запущен и активен
- В логах нет ошибок связи с API Telegram 